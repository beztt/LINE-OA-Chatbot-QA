# ü§ñ LINE OA Q&A Chatbot (with Pinecone + GPT Hybrid)

‡∏£‡∏∞‡∏ö‡∏ö LINE Bot ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏£‡∏∞‡∏ö‡∏ö (‡πÄ‡∏ä‡πà‡∏ô DTMS, Dashboard, ‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á ‡∏Ø‡∏•‡∏Ø)  
‡πÇ‡∏î‡∏¢‡πÉ‡∏ä‡πâ Pinecone Vector Search + GPT Rephrasing + Fallback Matching ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡∏î‡∏π‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏û‡∏π‡∏î‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏Ñ‡∏ô‡∏à‡∏£‡∏¥‡∏á

---

## ‚úÖ Features

- ‡πÉ‡∏ä‡πâ Pinecone vector DB match Q&A ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á
- ‡πÉ‡∏ä‡πâ GPT (gpt-3.5-turbo ‡∏´‡∏£‡∏∑‡∏≠ gpt-4-turbo) ‡∏ä‡πà‡∏ß‡∏¢‡πÅ‡∏ï‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡πÉ‡∏´‡πâ‡∏ô‡∏∏‡πà‡∏°‡∏ô‡∏ß‡∏•
- ‡∏°‡∏µ‡∏£‡∏∞‡∏ö‡∏ö fallback local match ‡∏´‡∏≤‡∏Å GPT ‡∏´‡∏£‡∏∑‡∏≠ Pinecone ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
- ‡∏ï‡∏≠‡∏ö‡∏Ñ‡∏≥‡∏ó‡∏±‡∏Å‡∏ó‡∏≤‡∏¢ / ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì / ‡∏ó‡∏î‡∏™‡∏≠‡∏ö ‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏°‡∏ô‡∏∏‡∏©‡∏¢‡πå
- ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï Q&A ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏ú‡πà‡∏≤‡∏ô `qa_data.json`

---

## üß† Architecture

```mermaid
flowchart TD
  A[User ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° LINE] --> B[/FastAPI /webhook/]
  B --> C{‡∏Ç‡∏∂‡πâ‡∏ô‡∏ï‡πâ‡∏ô‡∏î‡πâ‡∏ß‡∏¢ "bot "?}
  C -- No --> C1[‡∏ï‡∏≠‡∏ö Greeting ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°]
  C -- Yes --> D[Intent: ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°?]
  D -- No --> D1[‡∏ï‡∏≠‡∏ö: ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°]
  D -- Yes --> E[Pinecone vector search]
  E -->|score >= 0.85| F1[‡∏ï‡∏≠‡∏ö‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å Q&A]
  E -->|score >= 0.5| F2[‡πÉ‡∏ä‡πâ GPT rephrase ‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö]
  E -->|score < 0.5| F3[fallback local match ‡∏´‡∏£‡∏∑‡∏≠‡∏ö‡∏≠‡∏Å‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à]
  F1 --> G[‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Å‡∏•‡∏±‡∏ö LINE]
  F2 --> G
  F3 --> G
  C1 --> G
  D1 --> G
```

---

## üì¶ Project Structure

```
.
‚îú‚îÄ‚îÄ main.py                   # LINE Webhook Endpoint
‚îú‚îÄ‚îÄ embed_qa_to_pinecone.py   # ‡∏ù‡∏±‡∏á Q&A ‡πÄ‡∏Ç‡πâ‡∏≤ Pinecone
‚îú‚îÄ‚îÄ qa_data.json              # ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°-‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
‚îú‚îÄ‚îÄ .env                      # ‡πÄ‡∏Å‡πá‡∏ö API keys
‚îú‚îÄ‚îÄ requirements.txt
‚îú‚îÄ‚îÄ render.yaml               # (optional) ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö deploy ‡∏Ç‡∏∂‡πâ‡∏ô Render
‚îî‚îÄ‚îÄ utils/
    ‚îú‚îÄ‚îÄ qa_matcher.py
    ‚îú‚îÄ‚îÄ pinecone_utils.py
    ‚îú‚îÄ‚îÄ prompt_builder.py
    ‚îú‚îÄ‚îÄ intent_detector.py
```

---

## üõ†Ô∏è Setup & Run

1. ‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á dependencies:

```bash
pip install -r requirements.txt
```

2. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ .env:

```env
OPENAI_API_KEY=...
PINECONE_API_KEY=...
PINECONE_INDEX_NAME=qa-index
PINECONE_REGION=...
LINE_CHANNEL_SECRET=...
LINE_CHANNEL_ACCESS_TOKEN=...
```

3. ‡∏ù‡∏±‡∏á Q&A ‡∏•‡∏á Pinecone:

```bash
python embed_qa_to_pinecone.py
```

4. ‡∏£‡∏±‡∏ô Server:

```bash
python -m uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

5. ‡πÉ‡∏ä‡πâ ngrok ‡πÄ‡∏û‡∏∑‡πà‡∏≠ expose local webhook:

```bash
ngrok http 8000
```

6. ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤ Webhook URL ‡πÉ‡∏ô LINE Developer Console

---

## üß™ Test Cases

| ‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó         | ‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°                       | ‡∏û‡∏§‡∏ï‡∏¥‡∏Å‡∏£‡∏£‡∏°‡∏ó‡∏µ‡πà‡∏Ñ‡∏≤‡∏î‡∏´‡∏ß‡∏±‡∏á                                            |
| -------------- | ----------------------------------- | ------------------------------------------------------------- |
| üéØ ‡∏ï‡∏£‡∏á Q&A     | `‡∏•‡∏∑‡∏°‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô dashboard ‡∏ï‡πâ‡∏≠‡∏á‡∏ó‡∏≥‡∏¢‡∏±‡∏á‡πÑ‡∏á` | ‡∏ï‡∏≠‡∏ö‡∏ï‡∏£‡∏á‡∏à‡∏≤‡∏Å Pinecone                                            |
| üîÅ ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á   | `‡∏•‡∏∑‡∏° password ‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡∏∞‡∏ö‡∏ö`             | ‡πÉ‡∏ä‡πâ GPT ‡πÅ‡∏ï‡πà‡∏á‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö‡∏à‡∏≤‡∏Å Q&A ‡∏ó‡∏µ‡πà‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Ñ‡∏µ‡∏¢‡∏á                         |
| üß™ test        | `test`                              | ‡∏ï‡∏≠‡∏ö "‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏Ñ‡∏£‡∏±‡∏ö ‚úÖ"                                  |
| üôè ‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì      | `‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏±‡∏ö`                        | ‡∏ï‡∏≠‡∏ö "‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö üòä"                                            |
| üôå ‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ      | `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö`                        | ‡∏ï‡∏≠‡∏ö "‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö üòä ‡∏´‡∏≤‡∏Å‡∏°‡∏µ‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏°‡∏≤‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö"              |
| ‚ùå ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πà‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏° | `‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏°‡πÑ‡∏´‡∏°`                 | ‡∏ï‡∏≠‡∏ö fallback ‡∏™‡∏∏‡∏†‡∏≤‡∏û ‡πÄ‡∏ä‡πà‡∏ô "‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏à‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ô‡∏µ‡πâ‡∏Ñ‡∏£‡∏±‡∏ö" |
| ‚ùì ‡πÑ‡∏°‡πà‡∏°‡∏µ match | `‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç network fail`            | fallback match ‡∏´‡∏£‡∏∑‡∏≠‡πÅ‡∏à‡πâ‡∏á‡∏ß‡πà‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö                          |

---

## üß† Notes

- ‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏° ignore ‡πÑ‡∏ü‡∏•‡πå‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡πÉ‡∏ô .gitignore:

```gitignore
.env
qa_data.json
```

- ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡πÄ‡∏û‡∏¥‡πà‡∏° Q&A ‡πÑ‡∏î‡πâ‡πÇ‡∏î‡∏¢‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç `qa_data.json` ‡πÅ‡∏•‡πâ‡∏ß‡∏£‡∏±‡∏ô `embed_qa_to_pinecone.py` ‡πÉ‡∏´‡∏°‡πà

---
